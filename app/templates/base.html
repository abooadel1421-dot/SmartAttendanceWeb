<!DOCTYPE html>  
<html lang="ar" dir="rtl">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">  
    {% if title %}  
        <title>{{ title }} - لوحة تحكم الإدارة</title>  
    {% else %}  
        <title>لوحة تحكم الإدارة - نظام الحضور الذكي</title>  
    {% endif %}  
    
    {# استيراد Bootstrap 5 RTL من CDN #}  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" integrity="sha384-PJsj/BTVKkEyc71qz6FiUFleg1Hmfh7UYL/IxExMG5z3XyZqo5VWf9CoF2sOoQwm" crossorigin="anonymous">  
    
    {# أيقونات Bootstrap Icons #}  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">  
    
    {# تنسيقات مخصصة للوحة الإدارة #}  
    <style>  
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {  
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
            background-color: #f8fafc;
            /* للتأكد من أن الـ body لا يتدفق تحت الـ sidebar/navbar */
            overflow-x: hidden; 
        }  

        /* ==================== SIDEBAR ==================== */
        .sidebar {  
            position: fixed;  
            top: 0;  
            right: 0;  
            bottom: 0;  
            width: 260px;  
            background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%);  
            padding: 0;  
            overflow-y: auto;  
            z-index: 1000;  
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);  
            transition: transform 0.3s ease; /* إضافة انتقال للسلايد */
        }  

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }

        .sidebar-header {  
            padding: 1.5rem 1rem;  
            background: rgba(255,255,255,0.1);  
            border-bottom: 1px solid rgba(255,255,255,0.1);  
        }  

        .sidebar-brand {  
            color: #fff;  
            font-size: 1.25rem;  
            font-weight: 600;  
            text-decoration: none;  
            display: flex;  
            align-items: center;  
            gap: 0.5rem;  
        }  

        .sidebar-menu {  
            padding: 1rem 0;  
        }  

        .menu-section {  
            margin-bottom: 1.5rem;  
        }  

        .menu-section-title {  
            padding: 0.5rem 1rem;  
            color: rgba(255,255,255,0.6);  
            font-size: 0.75rem;  
            font-weight: 600;  
            text-transform: uppercase;  
            letter-spacing: 0.5px;  
        }  

        .sidebar-link {  
            display: flex;  
            align-items: center;  
            padding: 0.75rem 1rem;  
            color: rgba(255,255,255,0.85);  
            text-decoration: none;  
            transition: all 0.3s ease;  
            gap: 0.75rem;  
        }  

        .sidebar-link:hover {  
            background: rgba(255,255,255,0.1);  
            color: #fff;  
            padding-right: 1.5rem;  
        }  

        .sidebar-link.active {  
            background: rgba(255,255,255,0.15);  
            color: #fff;  
            border-right: 3px solid #60a5fa;  
            font-weight: 500;  
        }  

        .sidebar-link i {  
            font-size: 1.1rem;  
            width: 20px;  
            text-align: center;  
        }  

        /* ==================== MAIN CONTENT ==================== */
        .main-content {  
            margin-right: 260px;  
            min-height: 100vh;  
            background: #f8fafc;  
            transition: margin-right 0.3s ease; /* إضافة انتقال لـ margin */
        }  

        /* ==================== TOP NAVBAR - CORNER STYLE ==================== */
        .top-navbar {
            position: fixed;
            top: 0;
            right: 0;
            width: calc(100% - 260px);
            height: 70px;
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            padding: 0 2rem;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: width 0.3s ease; /* إضافة انتقال لـ width */
        }

        /* الأيقونة في الزاوية اليسرى */
        .navbar-brand-mini {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #1e40af;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .navbar-brand-mini i {
            font-size: 1.3rem;
        }

        /* القائمة والأزرار في الطرف الآخر */
        .navbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* أزرار النافبار */
        .btn-navbar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            background-color: transparent;
            color: #1e293b;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            cursor: pointer;
        }

        .btn-navbar:hover {
            background-color: #1e40af;
            color: #ffffff;
            border-color: #1e40af;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
        }

        .btn-navbar i {
            font-size: 1.1rem;
        }

        /* الفاصل */
        .navbar-divider {
            width: 1px;
            height: 35px;
            background-color: #e2e8f0;
        }

        /* ==================== CONTENT WRAPPER ==================== */
        .content-wrapper {  
            padding: 2rem;
            margin-top: 70px;
        }  

        .page-header {  
            margin-bottom: 2rem;  
        }  

        .page-title {  
            font-size: 1.75rem;  
            font-weight: 600;  
            color: #1e293b;  
            margin: 0;  
        }  

        .stats-card {  
            background: #fff;  
            border-radius: 12px;  
            padding: 1.5rem;  
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);  
            transition: transform 0.2s, box-shadow 0.2s;  
            border: 1px solid #e2e8f0;
        }  

        .stats-card:hover {  
            transform: translateY(-4px);  
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);  
        }  

        /* ==================== RESPONSIVE DESIGN ==================== */
        @media (max-width: 768px) {  
            .sidebar {  
                transform: translateX(100%);  
                /* عند إخفاء الـ sidebar، نجعل الـ main-content يأخذ كامل العرض */
                position: fixed; /* لكي يتم إخفاؤه بالكامل */
            }  

            .sidebar.show {  
                transform: translateX(0);  
                position: fixed; /* عند إظهار الـ sidebar، يبقى ثابتًا */
            }  

            .main-content {  
                margin-right: 0; /* لإعطاء المساحة كاملة للمحتوى */
            }

            .top-navbar {
                width: 100%;
                padding: 0 1rem;
            }

            .navbar-brand-mini {
                font-size: 1rem;
            }

            .navbar-brand-mini i {
                font-size: 1.2rem;
            }

            .btn-navbar {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
            }

            .btn-navbar i {
                font-size: 1rem;
            }

            .navbar-divider {
                display: none;
            }

            .content-wrapper {
                padding: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .top-navbar {
                height: 60px;
                padding: 0 0.75rem;
            }

            .content-wrapper {
                padding: 1rem;
                margin-top: 60px;
            }

            .navbar-brand-mini {
                display: none;
            }

            .btn-navbar span {
                display: none;
            }
        }
    </style>  
    
    {# BLOCK for page-specific CSS #}  
    {% block head_css %}{% endblock %}  

</head>  
<body>  
    <!-- Sidebar -->  
    <div class="sidebar" id="sidebar">  
        <div class="sidebar-header">  
            <a href="{{ url_for('admin.index') }}" class="sidebar-brand">
                <i class="bi bi-shield-check"></i>  
                لوحة الإدارة  
            </a>  
        </div>  
        
        <nav class="sidebar-menu">  
            <!-- القسم الرئيسي -->  
            <div class="menu-section">  
                <div class="menu-section-title">الرئيسية</div>  
                <a href="{{ url_for('admin.index') }}" class="sidebar-link {% if active_page == 'admin_dashboard' %}active{% endif %}">
                    <i class="bi bi-speedometer2"></i>  
                    <span>لوحة التحكم</span>  
                </a>  
            </div>  

            <!-- إدارة المستخدمين -->  
            <div class="menu-section">  
                <div class="menu-section-title">المستخدمين</div>  
                <a href="{{ url_for('admin.manage_users') }}" class="sidebar-link {% if active_page == 'manage_users' %}active{% endif %}">
                    <i class="bi bi-people"></i>  
                    <span>إدارة المستخدمين</span>  
                </a>  
                <a href="{{ url_for('admin.add_user') }}" class="sidebar-link {% if active_page == 'add_user' %}active{% endif %}">
                    <i class="bi bi-person-plus"></i>  
                    <span>إضافة مستخدم</span>  
                </a>  
            </div>  

            <!-- إدارة الطلاب -->  
            <div class="menu-section">  
                <div class="menu-section-title">الطلاب</div>  
                <a href="{{ url_for('admin.manage_students') }}" class="sidebar-link {% if active_page == 'manage_students' %}active{% endif %}">
                    <i class="bi bi-person-badge"></i>  
                    <span>إدارة الطلاب</span>  
                </a>  
                <a href="{{ url_for('admin.add_student') }}" class="sidebar-link {% if active_page == 'add_student' %}active{% endif %}">
                    <i class="bi bi-person-plus-fill"></i>  
                    <span>إضافة طالب</span>  
                </a>  
            </div>  

            <!-- إدارة البطاقات -->  
            <div class="menu-section">  
                <div class="menu-section-title">البطاقات الذكية</div>  
                <a href="{{ url_for('admin.manage_cards') }}" class="sidebar-link {% if active_page == 'manage_cards' %}active{% endif %}">
                    <i class="bi bi-credit-card"></i>  
                    <span>إدارة البطاقات</span>  
                </a>  
                <a href="{{ url_for('admin.add_card') }}" class="sidebar-link {% if active_page == 'add_card' %}active{% endif %}">
                    <i class="bi bi-credit-card-2-front"></i>  
                    <span>إصدار بطاقة جديدة</span>  
                </a>  
            </div>  

            <!-- إدارة الأجهزة -->  
            <div class="menu-section">  
                <div class="menu-section-title">الأجهزة</div>  
                <a href="{{ url_for('admin.manage_devices') }}" class="sidebar-link {% if active_page == 'manage_devices' %}active{% endif %}">
                    <i class="bi bi-hdd-network"></i>  
                    <span>إدارة الأجهزة</span>  
                </a>  
                <a href="{{ url_for('admin.add_device') }}" class="sidebar-link {% if active_page == 'add_device' %}active{% endif %}">
                    <i class="bi bi-plus-circle"></i>  
                    <span>إضافة جهاز</span>  
                </a>  
            </div>  

            <!-- الحضور والتقارير -->  
            <div class="menu-section">  
                <div class="menu-section-title">الحضور والتقارير</div>  
                <a href="{{ url_for('admin.view_attendance_logs') }}" class="sidebar-link {% if active_page == 'view_attendance_logs' %}active{% endif %}">
                    <i class="bi bi-clock-history"></i>  
                    <span>سجلات الحضور</span>  
                </a>  
                <a href="{{ url_for('admin.reports_dashboard') }}" class="sidebar-link {% if active_page == 'reports_dashboard' %}active{% endif %}">
                    <i class="bi bi-file-earmark-bar-graph"></i>  
                    <span>لوحة التقارير</span>  
                </a>  
                <a href="{{ url_for('admin.students_list') }}" class="sidebar-link {% if active_page == 'students_list' %}active{% endif %}">
                    <i class="bi bi-file-earmark-text"></i>  
                    <span>قائمة الطلاب</span>  
                </a>  
            </div>

            <!-- الإعدادات -->  
            <div class="menu-section">  
                <div class="menu-section-title">النظام</div>  
                <a href="{{ url_for('admin.system_settings') }}" class="sidebar-link {% if active_page == 'system_settings' %}active{% endif %}">
                    <i class="bi bi-gear"></i>  
                    <span>إعدادات النظام</span>  
                </a>  
            </div>  
        </nav>  
    </div>  

    <!-- Main Content -->  
    <div class="main-content">  
        <!-- Top Navbar -->
        <div class="top-navbar">
            <!-- الأيقونة واللوجو في الزاوية اليسرى -->
            <div class="navbar-brand-mini">
                <i class="bi bi-speedometer2"></i>
                <span>النظام</span>
            </div>

            <!-- الأزرار والقائمة في الزاوية اليمنى -->
            <div class="navbar-right">
                <!-- زر العودة للرئيسية -->
                <a href="{{ url_for('main.index') }}" class="btn-navbar" title="العودة للرئيسية">
                    <i class="bi bi-house-door"></i>
                    <span>الرئيسية</span>
                </a>

                <!-- فاصل -->
                <div class="navbar-divider"></div>

                <!-- أزرار المستخدم (عادية بدون dropdown) -->


                <!-- فاصل -->
                <div class="navbar-divider"></div>

                <!-- زر تسجيل الخروج -->
                <a href="{{ url_for('auth_bp.logout') }}" class="btn-navbar" title="تسجيل الخروج" style="color: #dc2626;">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>تسجيل الخروج</span>
                </a>
            </div>
        </div>

        <!-- Content Wrapper -->  
        <div class="content-wrapper">  
            {# رسائل Flash #}  
            {% with messages = get_flashed_messages(with_categories=true) %}  
                {% if messages %}  
                    {% for category, message in messages %}  
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">  
                            {{ message }}  
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>  
                        </div>  
                    {% endfor %}  
                {% endif %}  
            {% endwith %}  

            {# محتوى الصفحة الفعلي سيتم إدخاله هنا #}  
            {% block admin_content %}{% endblock admin_content %}  
        </div>  
    </div>  

    {# استيراد Bootstrap 5 JS من CDN #}  
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>  
    
    <script>  
        // دالة لتبديل الشريط الجانبي (للاستخدام مع زر، إذا أضفته)
        function toggleSidebar() {  
            document.getElementById('sidebar').classList.toggle('show');  
            // تعديل main-content margin و top-navbar width عند تبديل الشريط الجانبي
            const mainContent = document.querySelector('.main-content');
            const topNavbar = document.querySelector('.top-navbar');
            const sidebar = document.getElementById('sidebar');

            if (sidebar.classList.contains('show')) { // إذا كان الشريط الجانبي مرئياً (في وضع الموبايل)
                mainContent.style.marginRight = '260px'; // لتوفير مساحة للشريط الجانبي
                topNavbar.style.width = 'calc(100% - 260px)';
            } else if (window.innerWidth > 768) { // إذا كان مخفياً وعلى شاشة كبيرة
                 mainContent.style.marginRight = '260px'; // الحالة الافتراضية
                 topNavbar.style.width = 'calc(100% - 260px)';
            } else { // إذا كان مخفياً وعلى شاشة صغيرة
                mainContent.style.marginRight = '0';
                topNavbar.style.width = '100%';
            }
        }

        // إغلاق الـ sidebar عند الضغط على أي رابط (موبايل)
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('show');
                    // إعادة ضبط الـ main-content والـ top-navbar عند إخفاء الشريط الجانبي
                    document.querySelector('.main-content').style.marginRight = '0';
                    document.querySelector('.top-navbar').style.width = '100%';
                }
            });
        });
    </script>  

    {# BLOCK for page-specific JavaScript libraries #}  
    {% block body_js %}{% endblock %}  

    {# BLOCK for page-specific inline JavaScript or scripts that depend on body_js #}  
    {% block scripts %}{% endblock %}  

</body>  
</html>